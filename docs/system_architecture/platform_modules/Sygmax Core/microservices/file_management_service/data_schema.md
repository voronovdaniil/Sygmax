# **File Management Microservice Schema**

# –í–æ—Ä–æ–Ω–æ–≤ –î–∞–Ω–∏–∏–ª

## **File**
| –ü–æ–ª–µ          | –¢–∏–ø        | –û–ø–∏—Å–∞–Ω–∏–µ                                      | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|---------------|-----------|----------------------------------------------|-------------|
| id            | UUID      | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ñ–∞–π–ª–∞                | Primary Key |
| owner_id      | UUID      | ID –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ–∞–π–ª–∞                            | Foreign Key ‚Üí User(id) |
| workspace_id  | UUID      | ID –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞, –µ—Å–ª–∏ —Ñ–∞–π–ª –ø—Ä–∏–≤—è–∑–∞–Ω             | Foreign Key ‚Üí Workspace(id) |
| document_id   | UUID      | ID –¥–æ–∫—É–º–µ–Ω—Ç–∞, –µ—Å–ª–∏ —Ñ–∞–π–ª —Å–≤—è–∑–∞–Ω                | Nullable, Foreign Key ‚Üí Document(id) |
| file_path     | VARCHAR(255) | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤ S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ               | |
| file_name     | VARCHAR(255) | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞                 | |
| file_size     | BIGINT    | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö                         | |
| file_type     | VARCHAR(50)| MIME-—Ç–∏–ø —Ñ–∞–π–ª–∞                               | |
| is_active     | BOOLEAN   | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ñ–∞–π–ª                              | Default: `True` |
| created_at    | DATETIME  | –î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞                          | Auto timestamp |
| updated_at    | DATETIME  | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è                    | Auto timestamp |

---

## **FileVersion**
| –ü–æ–ª–µ          | –¢–∏–ø       | –û–ø–∏—Å–∞–Ω–∏–µ                                       | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|---------------|----------|-----------------------------------------------|-------------|
| id            | UUID     | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–µ—Ä—Å–∏–∏                | Primary Key |
| file_id       | UUID     | ID —Ñ–∞–π–ª–∞                                      | Foreign Key ‚Üí File(id) |
| version_number| INT      | –ù–æ–º–µ—Ä –≤–µ—Ä—Å–∏–∏                                   | Auto-increment |
| file_path     | VARCHAR(255) | –ü—É—Ç—å –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–∞ –≤ S3         | |
| created_at    | DATETIME | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ—Ä—Å–∏–∏                         | Auto timestamp |
| created_by    | UUID     | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–∑–¥–∞–≤—à–µ–≥–æ –≤–µ—Ä—Å–∏—é            | Foreign Key ‚Üí User(id) |

---

## **FileMetadata**
| –ü–æ–ª–µ        | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ                                        | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|-------------|---------|-------------------------------------------------|-------------|
| id          | UUID    | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä                        | Primary Key |
| file_id     | UUID    | ID —Ñ–∞–π–ª–∞                                        | Foreign Key ‚Üí File(id) |
| metadata    | JSONB   | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ                | Nullable |
| extracted_at| DATETIME| –í—Ä–µ–º—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö                     | Auto timestamp |

---

## **FileProcessingStatus**
| –ü–æ–ª–µ       | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|------------|---------|--------------------------------------------------|-------------|
| id         | UUID    | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä                         | Primary Key |
| file_id    | UUID    | ID —Ñ–∞–π–ª–∞                                         | Foreign Key ‚Üí File(id) |
| status     | ENUM(`pending`, `processing`, `completed`, `failed`) | –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ | |
| details    | TEXT    | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ              | Nullable |
| updated_at | DATETIME| –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞                | Auto timestamp |

---

## **TemporaryFile**
| –ü–æ–ª–µ       | –¢–∏–ø       | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|------------|----------|--------------------------------------------------|-------------|
| id         | UUID     | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞         | Primary Key |
| file_id    | UUID     | ID –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞                               | Foreign Key ‚Üí File(id) |
| temp_path  | VARCHAR(255)| –í—Ä–µ–º–µ–Ω–Ω—ã–π –ø—É—Ç—å –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è              | |
| created_at | DATETIME | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                                    | Auto timestamp |
| expires_at | DATETIME | –í—Ä–µ–º—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞                   | |

---

## **FileAccessLog**
| –ü–æ–ª–µ      | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|-----------|---------|--------------------------------------------------|-------------|
| id        | UUID    | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏                  | Primary Key |
| file_id   | UUID    | ID —Ñ–∞–π–ª–∞                                         | Foreign Key ‚Üí File(id) |
| user_id   | UUID    | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏–ª –¥–æ—Å—Ç—É–ø          | Foreign Key ‚Üí User(id) |
| action    | ENUM(`upload`, `download`, `delete`, `edit`) | –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è | |
| timestamp | DATETIME| –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è                        | Auto timestamp |
| ip_address| VARCHAR(45)| IP-–∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                         | |

---

## **FilePermission**
| –ü–æ–ª–µ       | –¢–∏–ø       | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|------------|----------|--------------------------------------------------|-------------|
| id         | UUID     | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä                         | Primary Key |
| file_id    | UUID     | ID —Ñ–∞–π–ª–∞                                         | Foreign Key ‚Üí File(id) |
| user_id    | UUID     | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–º–µ—é—â–µ–≥–æ –¥–æ—Å—Ç—É–ø                 | Foreign Key ‚Üí User(id) |
| permission | ENUM(`read`, `write`, `owner`) | –¢–∏–ø –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É          | |
| granted_at | DATETIME | –í—Ä–µ–º—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞                     | Auto timestamp |

---

## üìå **–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
1. **S3-–•—Ä–∞–Ω–∏–ª–∏—â–µ:**  
   - –ü–æ–ª–µ `file_path` –∏ `temp_path` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É –≤ S3.  

2. **–í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤:**  
   - `FileVersion` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.

3. **–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤:**  
   - `FileProcessingStatus` –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏.

4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞:**  
   - `FilePermission` –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –¥–ª—è —á—Ç–µ–Ω–∏—è, –∑–∞–ø–∏—Å–∏ –∏ –≤–ª–∞–¥–µ–Ω–∏—è.

5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π:**  
   - `FileAccessLog` —Ö—Ä–∞–Ω–∏—Ç –ª–æ–≥–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏.

6. **–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:**  
   - `TemporaryFile` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≤–µ—Ä—Å–∏–π —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è).

---

## üìå **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**
1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ORM-–º–æ–¥–µ–ª–µ–π –≤ Django.
2. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏.
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º.
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç–∏.
5. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

---

**–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å File Management –≥–æ—Ç–æ–≤ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏

